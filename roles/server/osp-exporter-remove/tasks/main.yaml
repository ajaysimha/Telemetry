- name: Stop prometheus exporter service
  service:
    name: prometheus_exporter
    state: stopped
- name: Find the name of the prometheus exporter unarchived directory
  find:
    path: /opt
    patterns: '*prometheus-exporter*'
    file_type: directory
  register: dir_name

- debug: var=dir_name.files[0].path 

- name: Delete /opt/prometheus-exporter directory
  file:
    path: "{{ dir_name.files[0].path }}"
    state: absent
- name: Delete /etc/systemd/system/prometheus_exporter.service
  file:
    path: /etc/systemd/system/prometheus_exporter.service
    state: absent
